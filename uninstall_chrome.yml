---
- name: Uninstall Google Chrome from Windows Server
  hosts: web_servers
  gather_facts: yes

  tasks:
    - name: Find Google Chrome Uninstall String in Registry
      win_shell: |
        Get-ItemProperty -Path "HKLM:\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Uninstall\Google Chrome" | Select-Object -ExpandProperty UninstallString
      register: chrome_uninstall_command
      ignore_errors: yes

    - name: Uninstall Google Chrome using registry uninstall string
      win_command: "{{ chrome_uninstall_command.stdout }}"
      when: chrome_uninstall_command.stdout is not none

    - name: Verify Google Chrome Uninstallation
      win_stat:
        path: "C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe"
      register: chrome_uninstalled

    - name: Check if Chrome was uninstalled
      debug:
        msg: "Google Chrome has been uninstalled successfully!"
      when: not chrome_uninstalled.stat.exists
